<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8' />
    <!--link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"-->
    <link href="lib/fonts/micons/material-design-icons.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="../../lib/css/themes/jquery-ui/default/jquery-ui.min.css" />
    <link rel="stylesheet" type="text/css" href="../../lib/css/fancytree/ui.fancytree.min.css" />
    <link rel="stylesheet" type="text/css" href="lib/css/materialize.css">
    <!--link rel="stylesheet" type="text/css" href="../../lib/css/themes/jquery-ui/redmond/jquery-ui.min.css" /-->
    <!--link rel="stylesheet" type="text/css" href="lib/css/jquery-ui.min.css" />
    <!--link rel="stylesheet" type="text/css" href="../../lib/css/themes/jquery-ui/redmond/jquery-ui.structure.min.css" />
    <link rel="stylesheet" type="text/css" href="../../lib/css/themes/jquery-ui/redmond/jquery-ui.theme.min.css" /-->
    <link rel="stylesheet" type="text/css" href="lib/css/vis.min.css" />

    <script type="text/javascript" src="../../lib/js/jquery-1.11.2.min.js"></script>
    <script type="text/javascript" src="../../lib/js/jquery-ui-1.11.4.full.min.js"></script>
    <!--script type="text/javascript" src="../../lib/js/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="../../lib/js/jquery-ui.min.js"></script-->
    <script type="text/javascript" src="../../lib/js/jquery.fancytree-all.min.js"></script>
    <script type="text/javascript" src="../../socket.io/socket.io.js"></script>
    <!--script type="text/javascript" src="lib/js/jquery-ui.min.js"></script-->
    <script type="text/javascript" src="lib/js/vis.min.js"></script>

    <script type="text/javascript" src="../../lib/js/translate.js"></script>
    <script type="text/javascript" src="lib/js/materialize.js"></script>
    <script type="text/javascript" src="../../lib/js/selectID.js"></script>
    <script type="text/javascript" src="../../lib/js/loStorage.js"></script>

    <script type="text/javascript" src="lib/js/words.js"></script>

    <style type="text/css">
        xxhtml {
            font-family: Arial, sans-serif;
        }

        xxbody,
        xxselect {
            font: 12pt sans;
        }

        #mynetwork {
            box-sizing: border-box;
            position: relative;
            width: 100%;
            height: 800px;
            border: 2px solid lightgray;
        }

        #config {
            float: left;
            width: 400px;
            height: 600px;
        }

        xxp {
            font-size: 16px;
            max-width: 700px;
        }


        xxtable.legend_table {
            font-size: 11px;
            border-width: 1px;
            border-color: #d3d3d3;
            border-style: solid;
        }

        xxtable.legend_table,
        td {
            border-width: 2px;
            border-color: #d3d3d3;
            border-style: solid;
            padding: 2px;
        }

        xxdiv.table_content {
            width: 80px;
            text-align: center;
        }

        xxdiv.table_description {
            width: 100px;
        }

        xx#operation {
            font-size: 28px;
        }

        xxinput.text {
            margin-bottom: 12px;
            width: 95%;
            padding: .4em;
        }

        xxfieldset {
            padding: 0;
            border: 0;
            margin-top: 25px;
        }

        xxh1 {
            margin: .6em 0;
        }

        xxlabel.text-label {
            line-height: 2;
            vertical-align: middle;
            font-family: Arial, sans-serif;
            font-weight: bold;
            font-size: 0.8em;
            text-align: right;
        }

        button[disabled="disabled"] {
            pointer-events: none;
        }

        a[disabled="disabled"] {
            pointer-events: none;
        }

        .btn-small {
            height: 24px;
            line-height: 24px;
            padding: 0 0.1rem;
            font-size: 0.7rem;
        }

        .w100 {
            width: 100%;
        }
    </style>

    <script type="text/javascript">
        //            font-weight: bold;
        //                        font: bold 12pt sans;
        //            display: block;
        //            height: 18px;
        //            line-height: 18px;
        //        const socket = io.connect();
        var systemLang = 'en';
        var systemConfig = {};
        var adapterConfig = {};
        var uptimeMap = {};
        var dateOptions = {
            "weekday": "short",
            "year": "numeric",
            "month": "long",
            "day": "2-digit",
            "hour": "2-digit",
            "minute": "2-digit",
            "second": "2-digit"
        };
        var installMsg = {};
        var cmdCallback = null;
        var activeCmdId = null;
        var $stdout = $('#stdout');
        var stdout = '';

        //--------------------------------------------------------- COMMONS -----------------------------------------------------------------------
        /** 
         * Translate word
         * @param {type} word
         * @returns {String}
         */
        function _(word) {
            var text = translateWord(word, systemLang, systemDictionary);

            for (var i = 1; i < arguments.length; i++) {
                var pos = text.indexOf('%s');
                if (pos !== -1) {
                    text = text.replace('%s', arguments[i]);
                }
            }

            return text;
        }
        var nodes = null;
        var edges = null;
        var network = null;
        // randomly create some nodes and edges

        var nodes = [{
                machine: 'test',
                label: 'Aus',
                connections: [
                    "test.Ein"
                ]
            },
            {
                label: '@=1m',
                machine: 'test',
                connections: [
                    "test.Aus"
                ]
            },
            {
                machine: 'test',
                label: 'Ein',
                connections: [
                    "test.Aus"
                ]
            },
            {
                machine: 'test',
                label: 'test',
                connections: [
                    "test.Aus",
                    "test.Ein",
                    "test.@"
                ]
            },
            {
                machine: 'rest',
                label: 'Aus',
                connections: []
            },
            {
                machine: 'rest',
                label: 'rest',
                connections: [
                    "rest.Aus"
                ]
            },
        ];

        // create connections between people
        // value corresponds with the amount of contact between two people
        var data;
        var options = {
            physics: {
                enabled: true,
                stabilization: false,
                barnesHut: {
                    gravitationalConstant: -20000,
                    centralGravity: 2,
                    damping: 0.5,
                    springLength: 225,
                    avoidOverlap: 0.8
                    //                        springLength: 180
                },
            },
            locales: {
                de: {
                    edit: 'Edit',
                    del: 'Lösche Auswahl',
                    back: 'Zurück',
                    addNode: 'State hinzufügen',
                    addEdge: 'Übergang hinzufügen',
                    editNode: 'Edit State',
                    editEdge: 'Edit Übergang',
                    addDescription: 'Auf freien Platz klicken um State zu positionieren!',
                    edgeDescription: 'Klicke auf von-State und ziehe Cursor zu auf-State',
                    editEdgeDescription: 'Click on the control points and drag them to a node to connect to it.',
                    createEdgeError: 'Kann keine Übergänge auf Cluster einfügen!',
                    deleteClusterError: 'Clusters können hier nicht gelöscht werden!',
                    editClusterError: 'Clusters können hier nicht editiert werden!'
                }
            },
            interaction: {
                hover: true,
                navigationButtons: true,
                selectConnectedEdges: false,
                tooltipDelay: 250
            },
            configure: false,
            nodes: {
                borderWidth: 2,
                borderWidthSelected: 10,
                color: createColor(),
                font: {
                    size: 20,
                    face: "verdana",
                    strokeWidth: 2
                },
                scaling: {
                    min: 5,
                    //                    max: null
                },
                shadow: {
                    enabled: true
                },
                shapeProperties: {
                    borderRadius: 10
                },
                size: 20
            },
            edges: {
                arrowStrikethrough: false,
                arrows: {
                    to: {
                        enabled: true,
                    }
                },
                color: {
                    inherit: false
                },
                font: {
                    color: "rgba(15,52,21,1)"
                },
                selfReferenceSize: 35,
                shadow: {
                    enabled: true
                },
                smooth: {
                    forceDirection: "none",
                    roundness: 0.75
                }
            },
            layout: {
                randomSeed: 2
            }, // just to make sure the layout is the same when the locale is changed
            manipulation: {
                enabled: false,
                initiallyActive: false,
                //                deleteNode: stDeleteNode,
                //                addEdge: saveEdgeData
            }
        };
        var network, container, $exportArea, importButton, exportButton, selection;

        function exportNetwork() {
            network.storePositions();
            setExport("");
            //            var nodes = objectToArray(network.getPositions());
            var nodes = [];
            data.nodes.forEach(function (el) {
                var elem = cloneObject(el);
                delete elem.color;
                delete elem.font;
                delete elem.size;
                delete elem.name;
                delete elem.shape;
                var conns = network.getConnectedNodes(elem.id, 'to');
                var edges = network.getConnectedEdges(elem.id);
                var conns = [];
                edges.forEach(function (eid) {
                    var e = cloneObject(data.edges.get(eid));
                    var f = e.from;
                    delete e.from;
                    delete e.machine;
                    delete e.label;
                    delete e.id;
                    if (f == elem.id) {
                        k = Object.keys(e);
                        if (k.length == 1 && k[0] == 'to')
                            e = e[k];
                        conns.push(e);
                    }
                });
                elem.connections = conns;
                delete elem.id;
                nodes.push(elem);
            });
            setExport(JSON.stringify(nodes, undefined, 2));
        }

        function setExport(text) {
            $exportArea.val(text);
            $exportArea.trigger('autoresize');;
        }

        function importNetwork() {
            var inputData = JSON.parse($exportArea.val());
            if (Array.isArray(inputData) && inputData.length > 0) {}
            data = createData(inputData);
            draw({
                manipulation: options.manipulation
            });
        }

        function destroy() {
            if (network !== null) {
                network.destroy();
                network = null;
            }
        }

        function createColor(background, border, node) {
            node = node || {};
            border = border || (node.color ? node.color.border : false) || 'blue';
            background = background || (node.color ? node.color.background : false) || 'lightblue';
            node.color = {
                border: border,
                background: background,
                highlight: {
                    border: border,
                    background: background
                },
                hover: {
                    border: border,
                    background: background
                }
            };
            return node.color;
        }

        function decorateNode(n) {
            var l = n.label.trim();
            n.machine = n.machine.trim();
            if (n.machine == l) {
                n.color = createColor('pink');
                n.shape = 'star';
                n.name = '*';
                n.font = {
                    size: 30
                };
                n.size = 30;
                n.id = l;
            } else if (l.startsWith('@')) {
                n.color = createColor('yellow');
                //                    var m = n.label.match(/^(\@.?)\=/)[1];
                var m = l.match(/^@(.?)\s*=\s*(.+)$/);
                n.shape = 'box';
                n.name = "@" + m[1] ? m[1] : '';
                n.timer = m[2];
            } else {
                n.name = n.label;
            }
            if (!n.id)
                n.id = n.machine + (n.machine == l ? '' : '.' + n.name);

        }

        function createData(nodes) {

            function getLabel(node) {
                if (!node)
                    return 'N/A';
                if (node.label && node.label != ' ' && node.machine != node.label)
                    return node.label;
                if (node.machine == node.label)
                    return '*';
                return '!' + node.id;
            }
            const data = {},
                ln = {},
                edges = [],
                nn = [];
            for (let n of nodes) {
                var node = cloneObject(n);
                node.name = node.label.startsWith('@') ? node.label.match(/^(@.?)\=/)[1] : node.label == node.machine ?
                    '*' : node.label;
                node.id = node.machine;
                if (node.machine != node.label)
                    node.id += '.' + node.name;
                ln[node.id] = node;
            }
            for (let k in ln) {
                var n = ln[k];
                if (n && n.connections)
                    for (let c of n.connections) {
                        if (typeof c === 'object') {
                            edges.push(c);
                        } else {
                            const fn = ln[n.id];
                            const cn = ln[c];
                            let l = getLabel(fn) + '>' + getLabel(cn);
                            const edge = {
                                from: n.id,
                                to: cn.id,
                                label: l,
                                id: fn.machine + ':' + l,
                                machine: fn.machine
                            };
                            edges.push(edge);
                        }
                    }
                decorateNode(n);
                nn.push(n);
            }
            data.nodes = new vis.DataSet(nn);
            data.nodes.on('*', function (event, properties, senderId) {
                addEvent({
                    prop: properties.items[0],
                    node: data.nodes.get(properties.items[0])
                }, 'Node changed');
            });
            data.edges = new vis.DataSet(edges);
            data.edges.on('*', function (event, properties, senderId) {
                addEvent({
                    prop: properties.items[0],
                    edge: data.edges.get(properties.items[0])
                }, 'Edge changed');
            });
            return data;
        }

        var events = [];

        function addEvent(obj, type) {
            if (events.length > 4)
                events.pop();
            events.unshift('<h6>' + type + ' event:' + new Date().toISOString() + '</h6>' + JSON.stringify(obj, null, 4));
            var s = '';
            events.forEach(function (x) {
                s += x;
            });
            document.getElementById('eventSpan').innerHTML = s;
        }

        function draw(opt) {
            destroy();
            network = new vis.Network(container, data, opt || options);
            network.on("configChange", function () {
                // this will immediately fix the height of the configuration
                // wrapper to prevent unecessary scrolls in chrome.
                // see https://github.com/almende/vis/issues/1568
                var div = container.getElementsByClassName('vis-configuration-wrapper')[0];
                div.style["height"] = div.getBoundingClientRect().height + "px";
            });

            //            network.on('zoom', function (params) {
            //                addEvent({
            //                    scale: params.scale
            //                }, 'Zoom ' + params.direction);
            //            });

            network.once('stabilized', function () {
                network.setOptions({
                    physics: {
                        stabilization: {
                            fit: false
                        }
                    }
                });
                network.stabilize();
            });
            clusterPositions = {};
            network.on("select", function (params) {
                params = getParams(params);
                if (params.edge) {
                    var edge = params.edge;
                    params.isstar = edge.from == edge.machine;
                    selection = edge;
                    prepareMenu();
                    addEvent(params, "Select Edge");
                } else if (params.cluster) {
                    params.machine = params.id.split(':')[1];
                    params.label = params.machine;
                    selection = params;
                    prepareMenu();
                    addEvent(params, "Select Cluster");
                } else if (params.node) {
                    var node = params.node;
                    selection = node;
                    params.isstar = node.label == node.machine;
                    prepareMenu();
                    addEvent(params, params.isstar ? 'Select Machine' : 'Select State');

                } // cannot get there....
            });
            setExport("");
        }

        function prepareMenu() {
            if (selection) {
                Materialize.Toast.removeAll();
                if (selection.id.split(':').length > 1) { // this is an edge! or an cluster
                    if (selection.id.startsWith('cluster:')) { // cluster selected
                        fromNode = null;
                        $tabMachineName.val(curMachine = selection.machine).prop('disabled', true);
                        $tabStateName.val(curState = '').prop('disabled', true);
                        $tabEdgeName.val(curEdge = '').prop('disabled', true);
                        enableDisableChange('#clusterButton', 'Open Machine', 'expand_less');
                        enableDisable(['#deleteButton', '#renameButton', '#createStateButton', '#createLinkButton'],
                            false);
                    } else { // edge selected
                        fromNode = null;
                        $tabMachineName.val(curMachine = selection.machine).prop('disabled', true);
                        $tabStateName.val(curState = '').prop('disabled', true);
                        $tabEdgeName.val(curEdge = selection.id).prop('disabled', true);
                        enableDisableChange('#deleteButton', selection.id.indexOf('*') + 1 ? null : 'Delete Link');
                        enableDisable(['#renameButton', '#createLinkButton'], false);
                        enableDisableChange('#createStateButton', 'Create State');
                        enableDisableChange('#clusterButton', 'Cluster Machine', 'expand_more');
                    }
                } else { // node selectedThis is 
                    $tabMachineName.val(curMachine = selection.machine).prop('disabled', true);
                    $tabEdgeName.val(curEdge = '').prop('disabled', true);
                    if (selection.label != selection.machine) { // a state
                        if (fromNode) {
                            enableDisableChange('#createLinkButton', 'Cancel Create Link');
                            var ok = false,
                                edge = {
                                    from: fromNode,
                                    to: selection.id
                                };
                            if (edge.from == edge.to && !confirm("Do you want to connect the node to itself?"))
                                ok = null;

                            var nf = data.nodes.get(edge.from);
                            var nt = data.nodes.get(edge.to);
                            if (nf.machine != nt.machine)
                                showError(
                                    `cannot connect states from different machines! "${nf.machine}" and "${nt.machine}"`
                                );
                            else if (nf.name.startsWith('@') && network.getConnectedNodes(nf.id, 'to').length > 0)
                                showError(`cannot connect more than ONE state to timer-states like "${nf.id}"!`);
                            else if (network.getConnectedNodes(nf.id, 'to').indexOf(nt.id) >= 0)
                                showError(
                                    `cannot connect more than ONE time to the SAME state:"${nf.id}" > "${nt.id}"!`);
                            else ok = ok !== null;
                            if (network)
                                network.unselectAll();
                            if (ok) {
                                edge.machine = nf.machine;
                                edge.label = nf.name + '>' + nt.name;
                                edge.id = edge.machine + ':' + edge.label;
                                data.edges.add(edge);
                                selection = fromNode = null;
                                prepareMenu();
                            } else
                                showMessage('Please select the target State!');
                        } else {
                            $tabStateName.val(curState = selection.label).prop('disabled', true);
                            enableDisableChange('#deleteButton', getMachineStates(selection.machine).length > 2 ?
                                'Delete State' : null);
                            enableDisableChange('#renameButton', 'Rename State');
                            enableDisableChange('#createStateButton', 'Create State');
                            enableDisableChange('#createLinkButton', getMachineStates(selection.machine).length < 3 ?
                                undefined : 'Create Link');
                            enableDisableChange('#clusterButton', 'Cluster Machine', 'expand_more');
                        }
                    } else { // a machine
                        if (fromNode) {
                            fromNode = null;
                            showError(`cannot connect states to Machines ('Stars'/*)!`);
                        }
                        $tabStateName.val(curState = '').prop('disabled', true);
                        enableDisableChange('#deleteButton', 'Delete Machine');
                        enableDisableChange('#renameButton', 'Rename Machine');
                        enableDisableChange('#createStateButton', 'Create State');
                        enableDisableChange('#createLinkButton');
                        enableDisableChange('#clusterButton', 'Cluster Machine', 'expand_more');
                    }
                }
            } else {
                fromNode = null;
                if (network)
                    network.unselectAll();
                enableDisable(['#deleteButton', '#renameButton', '#createLinkButton', '#clusterButton'], false);
                enableDisableChange('#createStateButton', 'Create State');
                $tabMachineName.val(curMachine = '').prop('disabled', true);
                $tabStateName.val(curState = '').prop('disabled', true);
                $tabEdgeName.val(curEdge = '').prop('disabled', true);
            }
        }

        function cloneObject(obj) {
            return JSON.parse(JSON.stringify(obj));
        }

        function getParams(par) {
            var params = cloneObject(par);
            var n = params.nodes;
            var e = [];
            delete params.pointer;
            delete params.event;
            params.edges.forEach(function (edge) {
                e.push(data.edges.get(edge))
            });
            if (n.length === 0 && e.length === 1) {
                params.id = params.edges[0];
                params.edge = e[0];
            } else
                params.edges = e;

            var nid = n.length == 1 && n[0];
            if (nid) {
                params.id = nid;
                var node = data.nodes.get(nid);
                if (node) {
                    var cn = cloneObject(node);
                    delete cn.color;
                    delete cn.font;
                    params.node = cn;
                } else if (network.isCluster(nid))
                    params.cluster = network.getNodesInCluster(nid);
            }
            if (typeof params.to === 'object')
                params.to = params.to.id
            if (typeof params.from === 'object')
                params.from = params.from.id
            return params;
        }

        function getMachineStates(machine) {
            return data.nodes.get({
                filter: function (item) {
                    return (item.machine == machine);
                }
            });
        }

        function createToast(string, icon) {
            var $toastContent = $((icon ? '<i class="medium material-icons">' + icon + '</i>&nbsp;&nbsp;' : '') +
                '<span><b>' + string + '</b></span>')
            //                .add($('<button class="btn-flat toast-action">OK</button>'))
            ;
            Materialize.toast($toastContent, 5000, (icon == 'error' ? 'red' : 'blue') + ' rounded');
        }

        function showError(string) {
            createToast(string, 'error');
        }

        function showMessage(string) {
            createToast(string, 'announcement');
        }

        function saveEdgeData(edge, callback) {
            if (edge.from == edge.to) {
                var r = confirm("Do you want to connect the node to itself?");
                if (r != true)
                    return callback(null);
            }

            if (typeof edge.to === 'object')
                edge.to = edge.to.id
            if (typeof edge.from === 'object')
                edge.from = edge.from.id
            var nf = data.nodes.get(edge.from);
            var nt = data.nodes.get(edge.to);

            if (nf.machine != nt.machine)
                return showError(`cannot connect states from different machines! "${nf.machine}" and "${nt.machine}"`,
                    callback());

            if (nt.label == nt.machine || nf.label == nf.machine) // this are '*' states!
                return showError(`cannot connect states to Machines ('Stars'/*)!`, callback());

            if (nf.name.startsWith('@') && network.getConnectedNodes(nf.id, 'to').length > 0)
                return showError(`cannot connect more than ONE state to timer-states like "${nf.id}"!`, callback());

            if (network.getConnectedNodes(nf.id, 'to').indexOf(nt.id) >= 0)
                return showError(`cannot connect more than ONE time to the SAME state:"${nf.id}" > "${nt.id}"!`,
                    callback());

            edge.machine = nf.machine;
            edge.label = nf.name + '>' + nt.name;
            edge.id = edge.machine + ':' + edge.label;
            //            clearEdgePopUp();
            callback(edge);
        }

        function changeOptions() {
            //            var div = container.getElementsByClassName('vis-configuration-wrapper')[0];
            options.configure = !options.configure;
            network.setOptions({
                configure: options.configure
            });
            //            div.style["height"] = options.configure ? div.getBoundingClientRect().height + "px" : '1px';            
            //            draw();
        }

        function stDeleteNode(params, callback) {
            var node = data.nodes.get(params.nodes[0]);
            if (!node)
                return;
            if (node.name == '*')
                return showError("Cannot delete '*'- (Machine-) States,\nyou need to delete machine!", callback());
            else if (getMachineStates(node.machine).length <= 2)
                return showError("Cannot delete last state from lachine,\nyou need to delete machhine!", callback());

            confirmMessage(`Do you really want to delete ${node.label}`, 'Delete Nopde', function (ok) {
                callback(ok ? params : null);
            });
        }
        var dialogMessage, $dialogConfirm, firstConnect = true,
            that = this;

        var main = {
            objects: {},
            states: {},
            mstate: {},
            sstate: {},
            currentId: null,
            currentHost: '',
            hosts: [],
            instances: [],
            that: this,
            changed: false,
            objectsLoaded: false,
            waitForRestart: false,
            selectId: null,
            connectCb: null,
            socket: io.connect(),

            //            socket: io.connect(location.protocol + '//' + location.host, {
            //                query: 'ws=true'
            //            }),
            saveConfig: function (attr, value) {
                if (!main.config) return;
                if (attr) main.config[attr] = value;

                if (typeof storage !== 'undefined') {
                    storage.set('adminConfig', JSON.stringify(main.config));
                }
            },
            initSelectId: function () {
                if (main.selectId) return main.selectId;
                main.selectId = $('#dialog-select-member').selectId('init', {
                    objects: main.objects,
                    states: main.states,
                    noMultiselect: true,
                    imgPath: '../../lib/css/fancytree/',
                    filter: {
                        type: 'state'
                    },
                    texts: {
                        select: _('Select'),
                        cancel: _('Cancel'),
                        all: _('All'),
                        id: _('ID'),
                        name: _('Name'),
                        role: _('Role'),
                        room: _('Room'),
                        value: _('Value'),
                        selectid: _('Select ID'),
                        from: _('From'),
                        lc: _('Last changed'),
                        ts: _('Time stamp'),
                        wait: _('Processing...'),
                        ack: _('Acknowledged')
                    },
                    columns: ['image', 'name', 'role', 'room', 'value']
                });
                return main.selectId;
            },
            addSState: function addSState(obj, id) {
                if (obj.type === 'state') {
                    var n = obj.common.name;
                    if (!main.mstate[n]) {
                        if (main.sstate[n]) {
                            main.mstate[n] = [id];
                            delete main.sstate[n];
                        } else
                            main.sstate[n] = id;
                    } else main.mstate[n].push(id);
                }

            },
            objectChange: function (id, obj) {
                if (obj) {
                    if (obj._rev && main.objects[id]) main.objects[id]._rev = obj._rev;
                    if (!main.objects[id] || JSON.stringify(main.objects[id]) != JSON.stringify(obj)) {
                        main.objects[id] = obj;
                    }
                } else if (main.objects[id]) {
                    var oldObj = {
                        _id: id,
                        type: main.objects[id].type
                    };
                    delete main.objects[id];
                    if (oldObj.type === 'instance') {
                        var pos = main.instances.indexOf(id);
                        if (pos !== -1) main.instances.splice(pos, 1);
                    } else if (oldObj.type === 'script') {
                        var pos = main.instances.indexOf(id);
                        if (pos !== -1) main.instances.splice(pos, 1);
                    } else if (id.match(/^script\.js\./) && oldObj.type === 'channel') {
                        var pos = main.instances.indexOf(id);
                        if (pos !== -1) main.instances.splice(pos, 1);
                    }
                }

                if (main.selectId) main.selectId.selectId('object', id, obj);

                if (id.match(/^system\.adapter\.[-\w]+\.[0-9]+$/)) { /// TODO
                    // Disable statemachine tab if no one script engine instance found
                    //                    var engines = main.fillEngines();
                    //                    $('#tabs').tabs('option', 'disabled', (engines && engines.length) ? [] : [4]);
                }

                addEvent(obj, `Object Change of ${id}`);
            },
            stateChange: function (id, state) {
                var s = {
                    ostate: main.states[id] || {},
                    nstate: cloneObject(state),
                };
                for (var k of Object.keys(state))
                    if (s.ostate[k] == s.nstate[k])
                        delete s.nstate[k];
                state.lc = s.nstate.lc = s.ostate.ts;
                if (!id.match(/^system\./)) {
                    addEvent(s, `State change of ${id}`);
                    /// TODO: check machine states to display them!
                }
                //id = id ? id.replace(/[\s'"]/g, '_') : ''; /// TODO - do not know what it does!
                //if (!id || !id.match(/\.messagebox$/)) {
                //    if (main.selectId) main.selectId.selectId('state', id, state);
                //}
                main.states[id] = state;
            },
            getStates: function (callback) {
                main.socket.emit('getStates', function (err, res) {
                    main.states = res;
                    if (typeof callback === 'function')
                        setTimeout(callback, 0);
                });
            },
            getObjects: function (callback) {
                main.socket.emit('getAllObjects', function (err, res) {
                    setTimeout(function () {
                        var obj;
                        main.objects = res;
                        for (var id in main.objects) {
                            if (id.slice(0, 7) === '_design') continue;

                            obj = res[id];
                            main.addSState(obj, id);
                            if (obj.type === 'instance') main.instances.push(id);
                            //                        if (obj.type === 'channel' && id.match(/^script\.js\./)) main.groups.push(id);
                            if (obj.type === 'host') main.hosts.push(id);
                        }
                        main.objectsLoaded = true;

                        //                    main.prepare();
                        //                    main.init();

                        if (typeof callback === 'function') callback();
                    }, 0);
                });
            },
            /** 
             * Read the settings for adapter
             * @param {type} callback
             */
            readInstanceConfig: function (callback) {
                systemConfig = main.objects['system.config'];
                addEvent(systemConfig, "System Config");
                if (systemConfig && systemConfig.common) {
                    systemLang = systemConfig.common.language;
                } else {
                    systemLang = window.navigator.userLanguage || window.navigator.language;

                    if (systemLang !== 'en' && systemLang !== 'de' && systemLang !== 'ru') {
                        systemConfig.common.language = 'en';
                        systemLang = 'en';
                    }
                }
                adapterConfig = main.objects['system.adapter.statemachine.0'];
                if (adapterConfig && adapterConfig.native)
                    adapterConfig = adapterConfig.native;
                else
                    adapterConfig = null;
                addEvent({
                    adapterConfig: adapterConfig,
                    language: systemLang,
                    states: Object.keys(main.states).length,
                    objects: Object.keys(main.objects).length,
                    hosts: Object.keys(main.hosts).length,
                }, "Adapter Config")
                if (typeof callback === 'function') {
                    callback();
                }
            },
            init: function (callb) {
                if (callb)
                    main.connectCb = callb;
                main.socket.on('permissionError', function (err) {
                    showMessage(_('Has no permission to %s %s %s', err.operation, err.type, (err.id ||
                        '')));
                });
                main.socket.on('objectChange', function (id, obj) {
                    setTimeout(main.objectChange, 0, id, obj);
                });
                main.socket.on('onUpdate', function (id, obj) {
                    setTimeout(main.stateChange, 0, id, obj);
                });
                main.socket.on('stateChange', function (id, obj) {
                    setTimeout(main.stateChange, 0, id, obj);
                });
                main.socket.on('connect', function () {
                    $('#connecting').hide();
                    if (firstConnect) {
                        firstConnect = false;

                        main.socket.emit('getUserPermissions', function (err, acl) {
                            main.acl = acl;
                            // Read system configuration
                            main.socket.emit('getObject', 'system.config', function (err, data) {
                                main.systemConfig = data;
                                if (!err && main.systemConfig && main.systemConfig.common) {
                                    systemLang = main.systemConfig.common.language;
                                } else {
                                    systemLang = window.navigator.userLanguage ||
                                        window.navigator.language;

                                    if (systemLang !== 'en' && systemLang !== 'de' &&
                                        systemLang !==
                                        'ru') {
                                        main.systemConfig.common.language = 'en';
                                        systemLang = 'en';
                                    }
                                }

                                translateAll();

                                main.getStates(function () {
                                    main.getObjects(function () {
                                        main.readInstanceConfig(
                                            function () {
                                                if (main.connectCb)
                                                    main.connectCb();
                                            })
                                    })
                                });
                            });
                        });
                    }
                    if (main.waitForRestart) {
                        location.reload();
                    }
                });
                main.socket.on('disconnect', function () {
                    $('#connecting').show();
                });
                main.socket.on('reconnect', function () {
                    $('#connecting').hide();
                    if (main.waitForRestart) {
                        location.reload();
                    }
                });
                main.socket.on('reauthenticate', function () {
                    location.reload();
                });
                main.socket.on('log', function (message) {
                    setTimeout(main.onLog, 0, message);
                });

            }
        };

        main.init(function () {
            options.locale = systemLang;
            data = createData(nodes);
            draw();
        });

        window.onbeforeunload = function (evt) {
            if (main.changed) {
                if (window.confirm(_('Script changes are not saved. Discard?'))) {
                    return null;
                } else {
                    return _('Configuration not saved.');
                }
            }
            return null;
        };

        function enableDisable(sel, value) { //value = true = enabled
            if (Array.isArray(sel))
                return sel.forEach(function (id) {
                    enableDisable(id, value);
                })

            var $sel = $(sel);
            if (value)
                $sel.removeClass('disabled');
            else
                $sel.addClass('disabled');
            //            .prop('disabled', !value);
        }

        function enableDisableChange(sel, text, icon) { //value = true = enabled
            if (Array.isArray(sel))
                return sel.forEach(function (id) {
                    enableDisableChange(id, text, icon);
                })

            var $sel = $(sel);
            var ch = $sel.children();
            var t = $sel.data('mytype');
            if (t) {
                $sel.removeClass(t);
                $sel.data('mytype', null);
            }
            if (text) {
                var m = text.match(/^\s*\(([\w\s*]+)\)\s*(.*)\s*$/);
                if (m) {
                    $sel.data('mytype', m[1])
                    $sel.addClass(m[1]);
                    text = m[2];
                }
                $sel.removeClass('disabled');
                if (ch.length > 1)
                    ch[1].innerHTML = text;
            }
            if (icon && ch.length > 0)
                ch[0].innerHTML = icon;
            if (!text && !icon)
                $sel.addClass('disabled');
            else
                $sel.removeClass('disabled');
            //            .prop('disabled', !value);
        }

        function changeButtonText(sel, text, icon) {
            var ch = $(sel).children();
            if (icon)
                ch[0].innerHTML = icon;
            if (text && ch.length > 1)
                ch[1].innerHTML = text;
        }

        function showHide(sel, value) { //value = true = enabled
            var $sel = $(sel);
            if (!value)
                $sel.hide();
            else
                $sel.show();
            //            $(sel).prop('disabled',!value);
        }

        function showModal(o) {
            if (typeof o === 'string')
                o = {
                    text: o
                };
            else if (typeof o !== 'object')
                o = {};
            var t = $('#modalText').children();
            t[0].innerHTML = o.title || "Information";
            t[1].innerHTML = o.text || ' ';
            o.buttons = o.buttons || 1;
            if (typeof o.buttons === 'string')
                o.buttons = o.buttons.split(',');
            else if (!Array.isArray(o.buttons)) {
                o.buttons = o.buttons == 1 ? ['OK'] : ['OK', 'cancel'];
            }
            $('#modalIcon').text(o.icon || o.buttons.length > 1 ? 'help' : "info");
            enableDisableChange('#modalOk', o.buttons[0])
            if (o.buttons.length == 1)
                $('#modalExit').hide();
            else {
                enableDisableChange('#modalExit', o.buttons[1])
                $('#modalExit').show();
            }
            $('#dialog-modal').data('callback', o.callback);
            $('#dialog-modal').modal('open');
        }

        function confirmMessage(message, title, icon, buttons, callback) {
            if (typeof icon == 'function') {
                callback = icon;
                icon = undefined,
                    buttons = 2;
            } else if (typeof buttons == 'function') {
                callback = buttons;
                buttons = 2;
            }

            showModal({
                text: message,
                title: title,
                icon: icon,
                buttons: buttons,
                callback: callback,
            });
        }

        function fitMachine(machine) {
            var nn = [],
                nd = {
                    nodes: getMachineStates(machine).forEach(function (n) {
                        return nn.push(n.id);
                    }),
                    animation: {
                        duration: 500
                    }
                }
            network.fit(nn);
        }

        var $tabMachineName, $tabStateName, $tabEdgeName, $okData, $cancelData, curMachine, curState, curEdge, curVar,
            curEvent,fromNode;
        $(function () {
            container = document.getElementById('mynetwork');
            $exportArea = $('#input_output');
            importButton = document.getElementById('import_button');
            exportButton = document.getElementById('export_button');
            $('#dialog-modal').modal({
                dismissible: true, // Modal can be dismissed by clicking outside of the modal
                opacity: .5, // Opacity of modal background
                inDuration: 200, // Transition in duration
                outDuration: 200, // Transition out duration
                startingTop: '5%', // Starting top style attribute
                endingTop: '10%', // Ending top style attribute
            });

            $('#modalOk').unbind('click').click(function (event) {
                var fun = $('#dialog-modal').data('callback');
                if (typeof fun == 'function')
                    fun(event);
            });
            $('#dialog-edit-insert-id').click(function () {
                var sid = main.initSelectId();
                sid.selectId('show', function (newId) {
                    showMessage(newId);
                    //                    that.editorDialog.insert('"' + newId + '"' + ((that.main.objects[newId] && that.main.objects[newId].common && that.main.objects[newId].common.name) ? ('/*' + that.main.objects[newId].common.name + '*/') : ''));
                    //                    that.editorDialog.focus();
                });
            });

            $okData = $('#okData');
            $cancelData = $('#cancelData');
            enableDisable('button.ok-cancel', false);
            $cancelData.unbind('click').click(function (e) {
                enableDisable('button.ok-cancel', false);
                $tabMachineName.prop('disabled', true);
                $tabStateName.prop('disabled', true);
                $tabEdgeName.prop('disabled', true);
                fromNode = selection = null;
                prepareMenu();
            });
            // Read all positions, selected widgets for every view,
            // Selected view, selected menu page,
            // Selected widget or view page
            // Selected filter
            if (typeof storage !== 'undefined') {
                try {
                    main.config = storage.get('adminConfig');
                    if (main.config) {
                        main.config = JSON.parse(main.config);
                    } else {
                        main.config = {};
                    }
                } catch (e) {
                    console.log('Cannot load edit config');
                    main.config = {};
                }
            } //            alert('Selection length:' + $("#node-popUp").length + ', ' + $("#nodepopUp").length+ ', ' + $("#nodePopUp").length)
            $tabMachineName = $('#tab-machine-name').prop('disabled', true).unbind('change').change(function () {
                curMachine = $(this).val();
            });
            $tabStateName = $('#tab-state-name').prop('disabled', true).unbind('change').change(function () {
                curState = $(this).val();
            });
            $tabEdgeName = $('#tab-edge-name').prop('disabled', true).unbind('change').change(function () {
                curEdge = $(this).val();
            });
            $('#tab-physics').prop('checked', options.physics.enabled).unbind('change').change(function () {
                options.physics.enabled = this.checked;
                network.setOptions({
                    physics: {
                        enabled: options.physics.enabled
                    }
                });
                $('#tab-physics-label').html('Physics ' + (this.checked ? 'enabled' : 'disabled'));
                if (this.checked)
                    network.startSimulation();
                else network.stopSimulation();
            });
            $('#importButton').unbind('click').click(function (event) {
                importNetwork();
            });
            $('#exportButton').unbind('click').click(function (event) {
                exportNetwork();
            });
            $('#destroyButton').unbind('click').click(function (event) {
                destroy();
            });
            prepareMenu();
            $('#createLinkButton').unbind('click').click(function (event) {
                if (fromNode) {
                    enableDisable('#createLinkButton', false);
                    fitMachine(data.nodes.get(fromNode).machine);
                    selection = fromNode = null;
                    network.unselectAll();
                    Materialize.Toast.removeAll();
                    enableDisableChange('#createLinkButton', 'CreateLink');
                    enableDisable('#createLinkButton', false);
                    prepareMenu();
                } else if (selection) {
                    fromNode = selection.id;
                    network.unselectAll();
                    enableDisableChange('#createLinkButton', '(red)Cancel Link');
                    showMessage('Please select the target State!');
                }
            });
            $('#deleteButton').unbind('click').click(function (event) {
                if (selection) {
                    var title = "Delete ";
                    var message = 'Do you really want to delete ';
                    var mend = "</b> ?";
                    if (selection.id.match(/.+\:.+\>.+/)) { // edge
                        confirmMessage(message + 'transition <b>' + selection.id + mend, title +
                            'Transition', 'ask',
                            function (e) {
                                data.edges.remove(selection.id);
                                selection = null;
                                prepareMenu();
                            });
                    } else if (selection.id == selection.machine) {
                        confirmMessage(message + 'machine <b>' + selection.id + mend, title + 'Machine',
                            'ask',
                            function (e) {
                                getMachineStates(selection.id).forEach(function (n) {
                                    network.getConnectedEdges(n).forEach(function (e) {
                                        data.edges.remove(e);
                                    });
                                    data.nodes.remove(n);
                                });
                                data.nodes.remove();
                                selection = null;
                                prepareMenu();
                            });
                    } else {
                        confirmMessage(message + 'state <b>' + selection.id + mend, title + 'State',
                            'ask',
                            function (e) {
                                network.getConnectedEdges(selection.id).forEach(function (e) {
                                    data.edges.remove(e);
                                });
                                data.nodes.remove(selection.id);
                                selection = null;
                                prepareMenu();
                            });
                    }
                }
            });
            $('#createStateButton').unbind('click').click(function (event) {
                event.preventDefault();
                $tabMachineName.prop('disabled', false);
                $tabStateName.prop('disabled', false);
                enableDisable('button.ok-cancel', true);
                enableDisable(['#deleteButton', '#renameButton', '#createLinkButton', '#clusterButton','#createStateButton'], false);
                $tabStateName.val(curState = 'newState');
                if (! curMachine || curMachine=='')
                    $tabMachineName.val(curMachine = 'newMachine');
                $okData.unbind('click').click(function (event) {
                    function verify(item, text, regexp, max) {
                        var v = item.val();
                        var r = typeof regexp === 'number' ? v.length >= regexp && (typeof max ===
                            'number' ?
                            v.length <= max :
                            true) : regexp.test(v);
                        if (r)
                            return true;
                        showMessage(text);
                    }
                    var ok = true;
                    ok = ok && verify($tabMachineName, "Länge muss zwischen 3 und 20 sein",
                        3, 20);
                    ok = ok && verify($tabMachineName,
                        "Text darf nur '$_A-Za-z0-9' enthalten",
                        /^\s*[$\w]+\s*$/);
                    ok = ok && verify($tabStateName, "Länge muss zwischen 3 und 20 sein", 3,
                        20);
                    ok = ok && verify($tabStateName,
                        "Text darf nur '$_A-Za-z0-9' enthalten oder @(x)=(*h)(*m)(*s)",
                        /^\s*([$\w]+|@(.?)\s*=\s*(.+?))\s*$/);
                    network.unselectAll();
                    fromNode = selection = null;
                    if (ok) {
                        //                        var m = $tabMachineName.val().trim();
                        //                        var l = $tabStateName.val().trim();
                        //                        var match = l.match(/^@(.?)\s*=\s*(.+)$/);
                        var node = {
                            machine: $tabMachineName.val().trim(),
                            label: $tabStateName.val().trim()
                        };
                        decorateNode(node);
                        if (data.nodes.get(node.id))
                            return showError(
                                `A state with this name exist already and cannot be added multiple times!`
                            );
                        var pos = network.getPositions(),
                            y = Number.POSITIVE_INFINITY,
                            x = Number.NEGATIVE_INFINITY;
                        Object.keys(pos).forEach(function (k) {
                            var p = pos[k];
                            y = Math.min(y, p.y);
                            x = Math.max(x, p.x);
                        });
                        node.x = x * 0.8;
                        node.y = y * 0.8;
                        data.nodes.add(node);
                        var nst = cloneObject(data.nodes.get(node.id));
                        var p = pos[nst.id];
                        if (p) {
                            nst.x = p.x;
                            nst.y = p.y;
                        }
                        if (!data.nodes.get(nst.machine)) {
                            nst.label = nst.machine;
                            decorateNode(nst);
                            data.nodes.add(nst);
                        } else
                            nst = data.nodes.get(nst.machine);

                        var conn = network.getConnectedNodes(nst.id, 'to');
                        if (conn.indexOf(node.id) < 0) {
                            var edge = {
                                to: node.id,
                                from: nst.id,
                                machine: nst.machine,
                                label: nst.name + '>' + node.name
                            };
                            edge.id = edge.machine + ':' + edge.label;
                            data.edges.add(edge);
                        }
                        fitMachine(node.machine);
                        $cancelData.click();
                    }
                });
            });
            $('#changeOptions').unbind('click').click(function (event) {
                options.configure = !options.configure;
                network.setOptions({
                    configure: options.configure
                });
            });
            $('#clusterButton').unbind('click').click(function (event) {
                var nid = selection.id;
                if (network.isCluster(nid)) {
                    network.openCluster(nid, {
                        releaseFunction: function (clusterPosition, containedNodesPositions) {
                            var newPositions = {};
                            for (nodeId in containedNodesPositions)
                                newPositions[nodeId] = {
                                    x: containedNodesPositions[nodeId].x,
                                    y: containedNodesPositions[nodeId].y
                                };
                            return newPositions;
                        }
                    });
                    var m = nid.split(':')[1];
                    data.edges.forEach(function (edge) {
                        data.edges.update(edge);
                    }, {
                        filter: function (item) {
                            return item.machine == m;
                        }
                    });
                } else {
                    var machine = data.nodes.get(nid);
                    if (!machine) return;
                    machine = machine.machine;
                    clusterOptionsByData = {
                        joinCondition: function (childOptions) {
                            return childOptions.machine == machine;
                        },
                        clusterNodeProperties: {
                            id: 'cluster:' + machine,
                            borderWidth: 3,
                            shape: 'database',
                            color: 'lightgreen',
                            label: machine,
                            font: {
                                size: 30
                            }
                        }
                    };
                    network.storePositions();
                    network.cluster(clusterOptionsByData);
                }
                selection = null;
                prepareMenu();
            });
        });
    </script>
</head>

<body>
    <div id="homeTemplate">
        <div class="row">
            <div class="col s1">
                <img src="/adapter/statemachine/statemachine.png" style="width: 3em; height: 3em" onclick="window.location.reload();">
            </div>
            <div class="col s6">
                <h5>StateMachine Setup</h5>
                <!--&nbsp;
                <a href="../../lib/css/themes/jquery-ui/redmond/jquery-ui.min.css">../../lib/css/themes/jquery-ui/redmond/jquery-ui.min.css</a>
                <link rel="stylesheet" type="text/css" href="../../lib/css/themes/jquery-ui/redmond/jquery-ui.structure.min.css" />
                <link rel="stylesheet" type="text/css" href="../../lib/css/themes/jquery-ui/redmond/jquery-ui.theme.min.css" />
                &nbsp;
                <a href="/lib/js/materialize.js">/lib/js/materialize.js</a>
                &nbsp;
                <a href="lib/css/vis.min.css">lib/css/vis.min.css</a-->
            </div>
            <div class="col s5">
                <h5>Control &amp; Options</h5>
            </div>
        </div>

        <div class="row">
            <div class="col s7">
                <div class="row">
                    <div class="col s2">
                        <input type="checkbox" id="tab-physics" checked="checked" class="btn-small" />
                        <label for="tab-physics">
                            <span id="tab-physics-label">Physics enabled</span>
                        </label>
                    </div>
                    <div class="col s2">
                        <button id="clusterButton" class="waves-effect waves-light btn not-ok-cancel btn-small w100 disabled">
                            <i class="material-icons left">expand_more</i>
                            <span>Cluster</span>
                        </button>
                    </div>
                    <div class="col s2">
                        <button id="deleteButton" class="waves-effect waves-light btn red not-ok-cancel btn-small w100 disabled">
                            <i class="material-icons left">remove</i>
                            <span>Delete</span>
                        </button>
                    </div>
                    <div class="col s2">
                        <button id="renameButton" class="waves-effect waves-light btn not-ok-cancel btn-small w100 disabled">
                            <i class="material-icons left">border_color</i>
                            <span>Rename</span>
                        </button>
                    </div>
                    <div class="col s2">
                        <button id="createLinkButton" class="waves-effect waves-light btn not-ok-cancel btn-small w100 disabled">
                            <i class="material-icons left">insert_link</i>
                            <span>Create Link</span>
                        </button>
                    </div>
                    <div class="col s2">
                        <button id="createStateButton" class="waves-effect waves-light btn not-ok-cancel btn-small w100">
                            <i class="material-icons left">repeate</i>
                            <span>Create State</span>
                        </button>
                    </div>
                </div>
                <div class="row">
                    <div id="mynetwork"></div>
                </div>
            </div>
            <div class="col s5">
                <div class="row">
                    <div class="input-field col s4">
                        <div class="row">
                            <i class="material-icons prefix">star_border</i>
                            <input type="text" placeholder="Machine Name" id="tab-machine-name" class="validate" required pattern="[$_\da-zA-Z][$\w]{1,20}">
                            <label for="tab-machine-name" data-error="wrong" data-success="right" class="active">Machine Name</label>
                            <span class="helper-text" data-error="2-20 characters starting with $_a-zA-Z and then can include 0-9" data-success="Ok"></span>
                        </div>
                        <button id="okData" class="ok-cancel waves-effect waves-light btn btn-small w100">
                            <i class="material-icons left">done</i>OK</button>
                    </div>
                    <div class="input-field col s4">
                        <div class="row">
                            <i class="material-icons prefix">repeate</i>
                            <input type="text" placeholder="State Name" id="tab-state-name" class="validate" required>
                            <label for="tab-state-name" data-error="wrong" data-success="right" class="active">State Name</label>
                        </div>
                        <button id="cancelData" class="ok-cancel waves-effect waves-light btn btn-small w100 brown">
                            <i class="material-icons left">cancel</i>Cancel</button>
                    </div>
                    <div class="input-field col s4">
                        <div class="row">
                            <i class="material-icons prefix">insert_link</i>
                            <input type="text" placeholder="Link Name" id="tab-edge-name" class="validate" required>
                            <label for="tab-edge-name" data-error="wrong" data-success="right" class="active">Link Name</label>
                        </div>
                        <!--button id="cancelData" class="ok-cancel waves-effect waves-light btn btn-small w100 brown">
                            <i class="material-icons left">cancel</i>Cancel</button-->
                    </div>

                </div>
                <div class="divider"></div>
                <div class="row">
                    <div class="col s4">
                        <button id="importButton" class="waves-effect waves-light btn not-ok-cancel  btn-small">
                            <i class="material-icons left">import_export</i>
                            <span>import</span>
                        </button>
                    </div>
                    <div class="col s4">
                        <button id="exportButton" class="waves-effect waves-light btn not-ok-cancel btn-small">
                            <i class="material-icons left">archive</i>
                            <span>export</span>
                        </button>
                    </div>
                    <div class="col s4">
                        <button id="destroyButton" class="waves-effect waves-light btn not-ok-cancel btn-small">
                            <i class="material-icons left">destroy</i>
                            <span>delete</span>
                        </button>
                    </div>
                </div>
                <div class="divider"></div>
                <div class="row">
                    <div class="col s4">
                        <button id="dialog-edit-insert-id" class="waves-effect waves-light btn not-ok-cancel btn-small">
                            <i class="material-icons left">insert_link</i>
                            <span>Insert ID</span>
                        </button>
                    </div>
                    <div class="col s4">
                        <button id="endcreate" class="waves-effect waves-light btn not-ok-cancel btn-small" onclick="showModal({text:'bla bla bla', buttons:'Ja,Nein!', icon:'help'})">
                            <i class="material-icons left">close</i>
                            <span>EndCreate</span>
                        </button>
                    </div>
                    <div class="col s4">
                        <button id="changeOptions" class="waves-effect waves-light btn not-ok-cancel btn-small">
                            <i class="material-icons left">assignment</i>
                            <span>Toggle Options</span>
                        </button>
                    </div>
                </div>
                <div class="divider"></div>
                <div class="row">
                    <div class="col s4">
                        <a class="waves-effect waves-light btn modal-trigger btn-small" href="#dialog-modal">Modal</a>
                    </div>
                    <div class="col s4">
                        <button id="test-clickOn" class="waves-effect waves-light btn btn-small" onclick="changeButtonText('#endcreate','newText','add');showHide('#endcreate',true);enableDisable('#endcreate',true)">
                            <i class="material-icons left">power_settings_new</i>Show</button>
                    </div>
                    <div class="col s4">
                        <button id="test-clickOff" class="waves-effect waves-light btn btn-small" onclick="changeButtonText('#endcreate','newText','remove');enableDisable('#endcreate',false)">
                            <i class="material-icons left">remove</i>Hide</button>
                    </div>
                </div>
                <div class="divider"></div>
                <div class="row">
                    <div class="col s6">
                        <label for="input_output">Input/output machines</label>
                        <textarea id="input_output" class="materialize-textarea"></textarea>
                        <!--textarea cols="40" rows="50" id=input_output></textarea-->
                    </div>
                    <div class="col s6">
                        <pre id="eventSpan" style="font-size: 0.8em"></pre>
                    </div>
                </div>
            </div>
            <!--div class="tile-stats"></div-->
            <!-- Modal Structure -->
            <div id="dialog-modal" class="modal">
                <div class="modal-content">
                    <div class="row">
                        <div class="col s2">
                            <i id="modalIcon" class="material-icons large">check</i>
                        </div>
                        <div id="modalText" class="col s10">
                            <h4>Title</h4>
                            <p>text</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="modalOk" class="modal-action modal-close waves-effect waves-light btn">
                        <i class="material-icons left">check</i>
                        <span>OK</span>
                    </button>
                    <button id="modalExit" class="modal-action modal-close waves-effect waves-light btn brown">
                        <i class="material-icons left">close</i>
                        <span>cancel</span>
                    </button>
                </div>
            </div>
            <div id="dialog-select-member" style="display:none"></div>
            <div id="dialog-confirm" title="Question" style="display: none">
                <p>
                    <span id="dialog-confirm-icon" class="ui-icon ui-icon-circle-check" style="float: left; margin: 0 7px 50px 0;"></span>
                    <span id="dialog-confirm-text" width="500px"></span>
                </p>
            </div>
        </div>

    </div>

</body>

</html>