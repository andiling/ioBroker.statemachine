<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8' />
    <link rel="stylesheet" type="text/css" href="../../lib/css/themes/jquery-ui/redmond/jquery-ui.min.css" />
    <!--link rel="stylesheet" type="text/css" href="../../lib/css/themes/jquery-ui/redmond/jquery-ui.structure.min.css" />
    <link rel="stylesheet" type="text/css" href="../../lib/css/themes/jquery-ui/redmond/jquery-ui.theme.min.css" /-->
    <link rel="stylesheet" type="text/css" href="lib/css/vis.min.css" />

    <script type="text/javascript" src="../../lib/js/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="../../socket.io/socket.io.js"></script>
    <script type="text/javascript" src="../../lib/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="lib/js/vis.min.js"></script>

    <script type="text/javascript" src="../../lib/js/translate.js"></script>
    <script type="text/javascript" src="../../lib/js/selectID.js"></script>
    <script type="text/javascript" src="../../lib/js/loStorage.js"></script>

    <script type="text/javascript" src="lib/js/words.js"></script>

    <style type="text/css">
        body,
        select {
            font: 10pt sans;
        }

        #mynetwork {
            box-sizing: border-box;
            position: relative;
            width: 100%;
            height: 800px;
            border: 2px solid lightgray;
        }

        #config {
            float: left;
            width: 400px;
            height: 600px;
        }

        p {
            font-size: 16px;
            max-width: 700px;
        }

        .clearfix::after {
            content: "";
            clear: both;
            display: table;
        }

        .column25 {
            float: left;
            box-sizing: border-box;
            width: 25%;
            padding: 10px;
        }

        .column33 {
            float: left;
            box-sizing: border-box;
            width: 33%;
            padding: 10px;
        }

        .column50 {
            float: left;
            box-sizing: border-box;
            width: 50%;
            padding: 10px;
        }

        .column40 {
            float: left;
            box-sizing: border-box;
            width: 40%;
            padding: 10px;
        }

        .column60 {
            float: left;
            box-sizing: border-box;
            width: 60%;
            padding: 10px;
        }

        .column80 {
            float: left;
            box-sizing: border-box;
            width: 80%;
            padding: 10px;
        }

        .column20 {
            float: left;
            box-sizing: border-box;
            width: 20%;
            padding: 10px;
        }

        table.legend_table {
            font-size: 11px;
            border-width: 1px;
            border-color: #d3d3d3;
            border-style: solid;
        }

        table.legend_table,
        td {
            border-width: 2px;
            border-color: #d3d3d3;
            border-style: solid;
            padding: 2px;
        }

        div.table_content {
            width: 80px;
            text-align: center;
        }

        div.table_description {
            width: 100px;
        }

        #operation {
            font-size: 28px;
        }

        #node-popUp {
            display: none;
            position: absolute;
            top: 350px;
            left: 170px;
            z-index: 299;
            width: 300px;
            height: 150px;
            background-color: #f9f9f9;
            border-style: solid;
            border-width: 3px;
            border-color: #5394ed;
            padding: 10px;
            text-align: center;
        }

        #edge-popUp {
            display: none;
            position: absolute;
            top: 350px;
            left: 170px;
            z-index: 299;
            width: 300px;
            height: 120px;
            background-color: #f9f9f9;
            border-style: solid;
            border-width: 3px;
            border-color: #5394ed;
            padding: 10px;
            text-align: center;
        }

        input.text {
            margin-bottom: 12px;
            width: 95%;
            padding: .4em;
        }

        fieldset {
            padding: 0;
            border: 0;
            margin-top: 25px;
        }

        h1 {
            margin: .6em 0;
        }

        label {
            display: block;
            width: 40%;
            height: 18px;
            text-align: right;
            padding: 1px;
        }
    </style>

    <script type="text/javascript">
        const socket = io.connect();
        var hosts = [];
        var mainHost = '';
        var systemLang = 'en';
        var systemConfig = {};
        var adapterConfig = {};
        var uptimeMap = {};
        var dateOptions = {
            "weekday": "short",
            "year": "numeric",
            "month": "long",
            "day": "2-digit",
            "hour": "2-digit",
            "minute": "2-digit",
            "second": "2-digit"
        };
        var installMsg = {};
        var cmdCallback = null;
        var activeCmdId = null;
        var $stdout = $('#stdout');
        var stdout = '';

        //--------------------------------------------------------- COMMONS -----------------------------------------------------------------------
        /** 
         * Read the settings for adapter
         * @param {type} callback
         */
        function readInstanceConfig(callback) {
            socket.emit('getObject', 'system.config', function (err, data) {
                systemConfig = data;
                if (!err && systemConfig && systemConfig.common) {
                    systemLang = systemConfig.common.language;
                } else {
                    systemLang = window.navigator.userLanguage || window.navigator.language;

                    if (systemLang !== 'en' && systemLang !== 'de' && systemLang !== 'ru') {
                        systemConfig.common.language = 'en';
                        systemLang = 'en';
                    }
                }

                socket.emit('getObject', 'system.adapter.info.0', function (err, res) {
                    if (!err && res && res.native) {
                        adapterConfig = res.native;
                    }
                    if (typeof callback === 'function') {
                        callback();
                    }
                });
            });
        }

        /** 
         * Translate word
         * @param {type} word
         * @returns {String}
         */
        function _(word) {
            var text = translateWord(word, systemLang, systemDictionary);

            for (var i = 1; i < arguments.length; i++) {
                var pos = text.indexOf('%s');
                if (pos !== -1) {
                    text = text.replace('%s', arguments[i]);
                }
            }

            return text;
        }
        var nodes = null;
        var edges = null;
        var network = null;
        // randomly create some nodes and edges

        var nodes = [{
                id: "test.Aus",
                machine: 'test',
                name: 'Aus',
                label: 'Aus',
                connections: [
                    "test.Ein"
                ]
            },
            {
                id: "test.@",
                label: '@=1m',
                machine: 'test',
                name: '@',
                shape: 'box',
                color: {
                    background: 'yellow',
                    hover: {
                        //                        background: 'orange'
                    },
                    highlight: {
                        //                        background: 'orange'
                    }
                },
                connections: [
                    "test.Aus"
                ]
            },
            {
                id: "test.Ein",
                machine: 'test',
                name: 'Ein',
                label: 'Ein',
                connections: [
                    "test.Aus"
                ]
            },
            {
                id: "test",
                machine: 'test',
                name: '*',
                shape: 'star',
                size: 30,
                font: {
                    size: 30
                },
                color: {
                    background: 'pink',
                    hover: {
                        background: 'pink'
                    },
                    highlight: {
                        background: 'pink'
                    }
                },
                connections: [
                    "test.@",
                    "test.Ein",
                    "test.Aus"
                ]
            },
            {
                id: "rest.Aus",
                machine: 'rest',
                name: 'Aus',
                label: 'Aus',
                connections: []
            },
            {
                id: "rest",
                machine: 'rest',
                name: '*',
                shape: 'star',
                size: 30,
                font: {
                    size: 30
                },
                label: ' ',
                color: {
                    background: 'pink',
                    border: 'purple'
                },
                connections: [
                    "rest.Aus"
                ]
            },
        ];

        // create connections between people
        // value corresponds with the amount of contact between two people
        var data;
        var options = {
            physics: {
                stabilization: false,
                barnesHut: {
                    gravitationalConstant: -20000,
                    centralGravity: 2,
                    damping: 0.5,
                    springLength: 225,
                    avoidOverlap: 0.8
                    //                        springLength: 180
                },
            },
            locales: {
                de: {
                    edit: 'Edit',
                    del: 'Lösche Auswahl',
                    back: 'Zurück',
                    addNode: 'State hinzufügen',
                    addEdge: 'Übergang hinzufügen',
                    editNode: 'Edit State',
                    editEdge: 'Edit Übergang',
                    addDescription: 'Auf freien Platz klicken um State zu positionieren!',
                    edgeDescription: 'Klicke auf von-State und ziehe Cursor zu auf-State',
                    editEdgeDescription: 'Click on the control points and drag them to a node to connect to it.',
                    createEdgeError: 'Kann keine Übergänge auf Cluster einfügen!',
                    deleteClusterError: 'Clusters können hier nicht gelöscht werden!',
                    editClusterError: 'Clusters können hier nicht editiert werden!'
                }
            },
            interaction: {
                hover: true,
                navigationButtons: true,
                selectConnectedEdges: false,
                tooltipDelay: 250
            },
            configure: false,
            nodes: {
                borderWidth: 2,
                borderWidthSelected: 10,
                color: createColor(),
                font: {
                    size: 20,
                    face: "verdana",
                    strokeWidth: 2
                },
                scaling: {
                    min: 5,
                    //                    max: null
                },
                shadow: {
                    enabled: true
                },
                shapeProperties: {
                    borderRadius: 10
                },
                size: 20
            },
            edges: {
                arrowStrikethrough: false,
                arrows: {
                    to: {
                        enabled: true,
                    }
                },
                color: {
                    inherit: false
                },
                font: {
                    color: "rgba(15,52,21,1)"
                },
                selfReferenceSize: 35,
                shadow: {
                    enabled: true
                },
                smooth: {
                    forceDirection: "none",
                    roundness: 0.75
                }
            },
            layout: {
                randomSeed: 2
            }, // just to make sure the layout is the same when the locale is changed
            manipulation: {
                enabled: true,
                initiallyActive: true,
                addNode: function (data, callback) {
                    stDialogOpen(data, 'Create State', callback);
                },
                editNode: stEditNode,
                editEdge: stEditEdge,
                deleteNode: stDeleteNode,
                addEdge: saveEdgeData
                /* ,
                               editEdge: {
                                   editWithoutDrag: function (data, callback) {
                                       document.getElementById('edge-operation').innerHTML = "Edit Edge";
                                       editEdgeWithoutDrag(data, callback);
                                   }
                               } */
            }
        };
        var network;
        var container;
        var exportArea;
        var importButton;
        var exportButton;

        function exportNetwork() {
            exportArea.value = "";
            //            var nodes = objectToArray(network.getPositions());
            var nodes = [];
            data.nodes.forEach(function (elem) {
                //                var conns = network.getConnectedNodes(elem.id, 'to');
                var edges = network.getConnectedEdges(elem.id);
                var conns = [];
                edges.forEach(function (eid) {
                    var e = data.edges.get(eid);
                    if (e.from == elem.id)
                        conns.push(e);
                });
                elem.connections = conns;
                nodes.push(elem);
            });
            exportArea.value = JSON.stringify(nodes, undefined, 2);;
            resizeExportArea();
        }

        function importNetwork() {
            var inputData = JSON.parse(exportArea.value);
            if (Array.isArray(inputData) && inputData.length > 0) {}
            data = createData(inputData);
            draw({
                manipulation: options.manipulation
            });
        }

        function resizeExportArea() {
            //            exportArea.style.height = (1 + exportArea.scrollHeight) + "px";
            exportArea.style.height = exportArea.scrollHeight + "px";
        }

        function destroy() {
            if (network !== null) {
                network.destroy();
                network = null;
            }
        }

        function createColor(background, border, node) {
            node = node || {};
            border = border || (node.color ? node.color.border : false) || 'blue';
            background = background || (node.color ? node.color.background : false) || 'lightblue';
            node.color = {
                border: border,
                background: background,
                highlight: {
                    border: border,
                    background: background
                },
                hover: {
                    border: border,
                    background: background
                }
            };
            return node.color;
        }

        function createData(nodes) {

            function getLabel(node) {
                if (!node)
                    return 'N/A';
                if (node.label && node.label != ' ')
                    return node.label;
                if (node.shape == 'star')
                    return '*';
                return '!' + node.id;
            }
            const data = {},
                ln = {},
                edges = [];
            for (let n of nodes)
                ln[n.id] = n;
            for (let n of nodes) {
                if (n && n.connections)
                    for (let c of n.connections) {
                        if (typeof c === 'object') {
                            edges.push(c);
                        } else {
                            const fn = ln[n.id];
                            const cn = ln[c];
                            let l = getLabel(fn) + '>' + getLabel(cn);
                            const edge = {
                                from: n.id,
                                to: cn.id,
                                label: l,
                                id: fn.machine + ':' + l,
                                machine: fn.machine
                            };
                            edges.push(edge);
                        }
                    }
                if (n.shape == 'star' && n.machine) {
                    n.label = n.machine;
                    n.color = createColor('pink');
                } else if (n.label.startsWith('@'))
                    n.color = createColor('yellow');
            }
            data.nodes = new vis.DataSet(nodes);
            data.nodes.on('*', function (event, properties, senderId) {
                addEvent({
                    prop: properties.items[0],
                    node: data.nodes.get(properties.items[0])
                }, 'Node changed');
            });
            data.edges = new vis.DataSet(edges);
            data.edges.on('*', function (event, properties, senderId) {
                addEvent({
                    prop: properties.items[0],
                    edge: data.edges.get(properties.items[0])
                }, 'Edge changed');
            });
            return data;
        }

        var events = [];

        function addEvent(obj, type) {
            if (events.length > 4)
                events.pop();
            events.unshift('<h2>' + type + ' event:</h2>' + JSON.stringify(obj, null, 4));
            var s = '';
            events.forEach(function (x) {
                s += x;
            });
            document.getElementById('eventSpan').innerHTML = s;
        }

        function draw(opt) {
            destroy();
            network = new vis.Network(container, data, opt || options);
            network.on("configChange", function () {
                // this will immediately fix the height of the configuration
                // wrapper to prevent unecessary scrolls in chrome.
                // see https://github.com/almende/vis/issues/1568
                var div = container.getElementsByClassName('vis-configuration-wrapper')[0];
                div.style["height"] = div.getBoundingClientRect().height + "px";
            });
            //            network.on("selectNode", function (params) {
            //                changeOnSelect(params, "Node");
            //            });
            network.on('zoom', function (params) {
                addEvent({
                    scale: params.scale
                }, 'Zoom ' + params.direction);
            });

            network.once('stabilized', function () {
                network.setOptions({
                    physics: {
                        stabilization: {
                            fit: false
                        }
                    }
                });
                network.stabilize();
            });
            clusterPositions = {};
            network.on("click", function (params) {
                if (params.nodes.length == 1 && params.nodes[0].startsWith('cluster:')) {
                    addEvent(getParams(params), "Select Cluster");
                }
            });
            network.on("doubleClick", function (params) {
                addEvent(getParams(params), "DoubleClick");
                if (params.nodes.length == 1) {
                    var nid = params.nodes[0];
                    if (network.isCluster(nid)) {
                        network.openCluster(nid, {
                            releaseFunction: function (clusterPosition, containedNodesPositions) {
                                var newPositions = {};
                                // clusterPosition = {x:clusterX, y:clusterY};
                                // containedNodesPositions = {nodeId:{x:nodeX,y:nodeY}, nodeId2....}
                                for (nodeId in containedNodesPositions)
                                    newPositions[nodeId] = {
                                        x: containedNodesPositions[nodeId].x,
                                        y: containedNodesPositions[nodeId].y
                                    };
                                return newPositions;
                            }
                        });
                        var m = nid.split(':')[1];
                        data.edges.forEach(function (edge) {
                            data.edges.update(edge);
                        }, {
                            filter: function (item) {
                                return item.machine == m;
                            }
                        });
                        return;
                    }
                    var machine = data.nodes.get(nid);
                    if (!machine) return;
                    machine = machine.machine;
                    //                  mass = 0;
                    clusterOptionsByData = {
                        joinCondition: function (childOptions) {
                            return childOptions.machine == machine;
                        },
                        /*                        
                                                processProperties: function (clusterOptions, childNodes, childEdges) {
                                                    var totalMass = 0;
                                                    for (var i = 0; i < childNodes.length; i++) {
                                                        totalMass += childNodes[i].mass;
                                                    }
                                                    clusterOptions.mass = totalMass;
                                                    return clusterOptions;
                                                },
                        */
                        clusterNodeProperties: {
                            id: 'cluster:' + machine,
                            borderWidth: 3,
                            shape: 'database',
                            color: 'lightgreen',
                            label: machine,
                            //                            mass: 1,
                            font: {
                                size: 30
                            }
                        }
                    };
                    network.storePositions();
                    network.cluster(clusterOptionsByData);
                }
            });

            network.on("selectEdge", function (params) {
                //               if (params.nodes.length==0)
                addEvent(getParams(params), "Select Edge");
            });
            network.on("selectNode", function (params) {
                //               if (params.nodes.length==0)
                params = getParams(params);
                if (params.nid) {
                    var node = params[params.nid];
                    tabMachineName.val(node.machine).show();
                    tabStateName.val(node.label).show();
                } else
                    tabStateName.hide();

                addEvent(params, "Select Node");
            });
            exportArea.value = "";
            resizeExportArea();
        }

        function cloneObject(obj) {
            return JSON.parse(JSON.stringify(obj));
        }

        function getParams(par) {
            var params = cloneObject(par);
            var n = params.nodes;
            var e = [];
            delete params.pointer;
            delete params.event;
            params.edges.forEach(function (edge) {
                e.push(data.edges.get(edge))
            });
            if (n.length === 0 && e.length == 1) {
                params.eid = params.edges[0];
                params[params.eid] = e[0];
            } else
                params.edges = e;

            var nid = n.length == 1 && n[0];
            if (nid) {
                params.nid = nid;
                var node = data.nodes.get(nid);
                if (node)
                    params[nid] = node;
                else if (network.isCluster(nid))
                    params[nid] = network.getNodesInCluster(nid);
            }
            if (typeof params.to === 'object')
                params.to = params.to.id
            if (typeof params.from === 'object')
                params.from = params.from.id
            return params;
        }

        function getMachineStates(machine) {
            return data.nodes.get({
                filter: function (item) {
                    return (item.machine == machine);
                }
            });
        }

        function checkStarState(state) {
            var pos = network.getPositions();
            if (state && state.id) {
                var nst = JSON.parse(JSON.stringify(state));
                var p = pos[nst.id];
                if (p) {
                    nst.x = p.x;
                    nst.y = p.y;
                }
                if (!data.nodes.get(nst.machine)) {
                    nst.size = 30;
                    nst.shape = 'star';
                    nst.name = '*';
                    nst.font = {
                        size: 30
                    };
                    nst.color = createColor('pink');
                    nst.label = nst.machine;
                    nst.id = nst.machine;
                    data.nodes.add(nst);
                } else
                    nst = data.nodes.get(nst.machine);

                var conn = network.getConnectedNodes(nst.id, 'to');
                if (conn.indexOf(state.id) < 0) {
                    var edge = {
                        to: state.id,
                        from: nst.id,
                        machine: nst.machine,
                        label: nst.name + '>' + state.name
                    };
                    edge.id = edge.machine + ':' + edge.label;
                    data.edges.add(edge);
                }
            }

        }

        function stEditEdge(edge, callback) {
            if (typeof edge.from === 'object')
                edge.from = edge.from.id
        }

        function saveEdgeData(edge, callback) {
            if (edge.from == edge.to) {
                var r = confirm("Do you want to connect the node to itself?");
                if (r != true)
                    return callback(null);
            }

            if (typeof edge.to === 'object')
                edge.to = edge.to.id
            if (typeof edge.from === 'object')
                edge.from = edge.from.id
            var nf = data.nodes.get(edge.from);
            var nt = data.nodes.get(edge.to);

            if (nf.machine != nt.machine) {
                alert(`cannot connect states from different machines! "${nf.machine}" and "${nt.machine}"`);
                return callback(null);
            }

            if (nf.name.startsWith('@') && network.getConnectedNodes(nf.id, 'to').length > 0) {
                alert(`cannot connect more than ONE state to timer-states like "${nf.id}"!`);
                return callback(null);
            }
            if (network.getConnectedNodes(nf.id, 'to').indexOf(nt.id) >= 0) {
                alert(`cannot connect more than ONE time to the SAME state:"${nf.id}" > "${nt.id}"!`);
                return callback(null);
            }

            if (nt.name == '*') {
                alert(`cannot connect states to * ('Stars')!`);
                return callback(null);
            }
            if (nf.name.startsWith('@')) {
                nf.name;
            }
            edge.machine = nf.machine;
            edge.label = nf.name + '>' + nt.name;
            edge.id = edge.machine + ':' + edge.label;
            //            clearEdgePopUp();
            callback(edge);
        }

        function changeOptions() {
            //            var div = container.getElementsByClassName('vis-configuration-wrapper')[0];
            options.configure = !options.configure;
            network.setOptions({
                configure: options.configure
            });
            //            div.style["height"] = options.configure ? div.getBoundingClientRect().height + "px" : '1px';            
            //            draw();
        }

        function init() {
            readInstanceConfig(function () {
                options.locale = systemLang;
                data = createData(nodes);
                draw();
            });

            container = document.getElementById('mynetwork');
            exportArea = document.getElementById('input_output');
            importButton = document.getElementById('import_button');
            exportButton = document.getElementById('export_button');
        }
        var stDialog;

        function stDeleteNode(data, callback) {
            if (data.name == '*') {
                alert("Cannot delete '*'- (Machine-) States,\nyou need to delete machine!");
                return callback(null);
            } else if (getMachineStates(data.machine).length <= 2) {
                alert("Cannot delete last state from lachine,\nyou need to delete machhine!");
                return callback(null);
            }
            stDialogOpen(data, 'Delete State', callback);
        }

        function stEditNode(data, callback) {
            if (data.name == '*') {
                alert("Cannot edit '*'- (Machine-) States!");
                return callback(null);
            }
            stDialogOpen(data, 'Edit State', callback);
        }

        function stDialogOpen(item, action, callback) {
            //            var $dialog = $("#state-dialog-form"); 
            stDialog.find('.state-dialog-field').removeClass("ui-state-error");
            stDialog._$machine = stDialog.find('#machine');
            stDialog._$tips = stDialog.find(".validateTips");
            stDialog._$name = stDialog.find('#name');
            stDialog._$item = item;
            stDialog._$create = action.startsWith('Create ');
            stDialog._$callback = callback;
            if (item && item.machine) {
                stDialog._$machine.val(item.machine);
            }
            if (item && item.name) {
                stDialog._$name.val(item.name);
            } else if (!stDialog._$create && item.label)
                stDialog._$name.val(item.label);

            stDialog._$machine.prop('disabled', !stDialog._$create);

            stDialog._$tips.text("All form fields are required");
            stDialog.dialog('option', 'title', action);
            stDialog.dialog("open");
        }

        function addState() {
            function verify(item, text, regexp, max) {
                var v = item.val();
                var r = typeof regexp === 'number' ? v.length >= regexp && (typeof max === 'number' ? v.length <= max :
                    true) : regexp.test(v);
                if (r)
                    return true;
                item.addClass("ui-state-error");
                stDialog._$tips.text(text);
            }

            var ok = true;
            ok = ok && verify(stDialog._$machine, "Länge muss zwischen 3 und 20 sein", 3, 20);
            ok = ok && verify(stDialog._$machine, "Text darf nur '$_A-Za-z0-9' enthalten", /^\s*[$\w]+\s*$/);
            ok = ok && verify(stDialog._$name, "Länge muss zwischen 3 und 20 sein", 3, 20);
            ok = ok && verify(stDialog._$name, "Text darf nur '$_A-Za-z0-9' enthalten oder @(x)=(*h)(*m)(*s)",
                /^\s*([$\w]+|@(.?)\s*=\s*(.+?))\s*$/);
            if (ok) {
                var m = stDialog._$machine.val().trim();
                var l = stDialog._$name.val().trim();
                var match = l.match(/^@(.?)\s*=\s*(.+)$/);
                var node = stDialog._$item;
                node.machine = m;
                if (match) {
                    node.shape = 'box';
                    node.timeout = match[2];
                    node.name = node.id = '@' + match[1];
                    node.label = l;
                    node.id = node.machine + '.' + node.name;
                    node.color = createColor('yellow');
                } else {
                    //                node.id = node.label.trim();
                    node.label = l;
                    node.name = l;
                    node.id = node.machine + '.' + node.name;
                }
                if (data.nodes.get(node.id)) {
                    alert(`A state with this name exist already and cannot be added multiple times!`);
                    return false;
                }
                stDialog._$tips.text("All form fields are required");
                stDialog.find('.state-dialog-field').removeClass("ui-state-error");
                stDialog._$item.name = l;
                stDialog._$item = node;
                stDialog._$item.machine = m;
                if (stDialog._$callback) {
                    stDialog._$callback(node);
                    stDialog._$callback = null;
                }
                stDialog.dialog("close");
                setTimeout(checkStarState, 100, node);
            }
            return ok;
        }
        var tabMachineName, tabStateName, tabPhysics;
        $(function () {
            //            alert('Selection length:' + $("#node-popUp").length + ', ' + $("#nodepopUp").length+ ', ' + $("#nodePopUp").length)
            tabMachineName = $('#tab-machine-name').prop('disabled', true);
            tabStateName = $('#tab-state-name');
            tabPhysics = $('#st-physics').checkboxradio();
//            $(".st-control").controlgroup({
//                "direction": "vertical"
//            });
            stDialog = $("#state-dialog-form").dialog({
                autoOpen: false,
                //                dialogClass: "no-close",
                height: 300,
                width: 500,
                modal: true,
                buttons: [{
                        text: 'Save State',
                        click: addState
                    },
                    {
                        text: 'Cancel',
                        click: function (event) {
                            $(this).dialog('close');
                        }
                    }
                ],
                close: function () {
                    form[0].reset();
                    if (stDialog._$callback)
                        stDialog._$callback(null);
                    stDialog._$callback = null;
                }
            });

            form = stDialog.find("form").on("submit", function (event) {
                event.preventDefault();
                addState();
            });
            $('.myButtons').button({
                icon: "ui-icon-star"
            });
            $('#create-state').button({
                icon: "ui-icon-star"
            });
            $('#importButton').click(function (event) {
                importNetwork();
            });
            $('#exportButton').click(function (event) {
                exportNetwork();
            });
            $('#destroyButton').click(function (event) {
                destroy();
            });
            $('#endcreate').click(function (event) {
                network.disableEditMode();
            });
            $('#create-state').click(function (event) {
                network.addNodeMode();
            });
            $('#createStateButton').click(function (event) {
                stDialogOpen({
                    machine: tabMachineName.val(),
                    name: 'newName'
                }, "Create State", null);
            });
            $('#changeOptions').click(function (event) {
                options.configure = !options.configure;
                $(this).text(options.configure ? "Hide Options" : "Show Options");
                network.setOptions({
                    configure: options.configure
                });
            });
            init();
        });
    </script>
</head>

<body>
    <div id="homeTemplate">


        <div class="page-title">
            <div class="column50">
                <!--a href="../../lib/css/themes/jquery-ui/redmond/jquery-ui.min.css">../../lib/css/themes/jquery-ui/redmond/jquery-ui.min.css</a>
                <link rel="stylesheet" type="text/css" href="../../lib/css/themes/jquery-ui/redmond/jquery-ui.structure.min.css" />
                    <link rel="stylesheet" type="text/css" href="../../lib/css/themes/jquery-ui/redmond/jquery-ui.theme.min.css" />
                <a href="lib/css/vis.min.css">lib/css/vis.min.css</a-->
                <h1>StateMachine Adapter</h1>
                <button id="changeOptions" class="myButtons">Show Options</button>

            </div>
            <div class="column25">
                <h3>import/export</h3>
            </div>
            <div class="column25">
                <h3>Options</h3>
            </div>
        </div>
        <div class="clearfix"></div>

        <div id="home-container">
            <div class="column50">
                <div id="mynetwork"></div>
            </div>

            <div class="column25 st-control">
                <button id="importButton" class="myButtons">import</button>
                <button id="exportButton" class="myButtons">export</button>
                <button id="destroyButton" class="myButtons">destroy</button>
                <br>
                <button id="createStateButton" class="myButtons">CreateState</button>
                <button id="create-state" class="myButtons">create-state</button>
                <div class="clearfix"></div>
                <button id="endcreate" class="myButtons">EndCreate</button>
                <div class="clearfix"></div>
                <label class="column25" for="machineName">Machine Name</label>
                <input class="column75" type="text" name="machineName" id="tab-machine-name" value="newMachine" class="text ui-widget-content ui-corner-all">
                <div class="clearfix"></div>
                <label class="column25" for="stateName">State Name</label>
                <input class="column75" type="text" name="stateName" id="tab-state-name" value="newState" class="text ui-widget-content ui-corner-all">
                <div class="clearfix"></div>
                <label for="physics">Insurance</label>
                <input type="checkbox" name="physics" id="st-physics">
                <br>
                <textarea cols="40" rows="50" id=input_output></textarea>
            </div>
            <div class="column25">
                <pre id="eventSpan"></pre>
            </div>
            <div class="clearfix"></div>
            <div class="tile-stats">
            </div>
        </div>
        <div id="state-dialog-form" title="...State">
            <p class="validateTips">All form fields are required.</p>
            <form>
                <fieldset>
                    <label class="column40 ui-font" for="machine">Machine Name</label>
                    <input class="column60" type="text" name="machine" id="machine" value="thisMachine" class="text ui-widget-content ui-corner-all state-dialog-field">
                    <div class="clearfix"></div>
                    <label class="column40 ui-font" for="name">State Name</label>
                    <input class="column60" type="text" name="name" id="name" value="newState" class="text ui-widget-content ui-corner-all state-dialog-field">
                    <!-- Allow form submission with keyboard without duplicating the dialog button -->
                    <input type="submit" tabindex="-1" style="position:absolute; top:-1000px">
                </fieldset>
            </form>
        </div>

    </div>

    </div>

</body>

</html>